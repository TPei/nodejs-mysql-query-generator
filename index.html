<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Nodejs-mysql-query-generator by TPei</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Nodejs-mysql-query-generator</h1>
        <h2>parses optional get parameters of a nodejs request url and generates a mysql query</h2>
        <a href="https://github.com/TPei/nodejs-mysql-query-generator" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <div class="highlight highlight-sh"><pre>npm install mysql-query-generator
</pre></div>

<ul>
<li>parses optional get parameters of a nodejs get request url and generates a mysql query</li>
<li>usage e.g. in REST API with extensive optional parameters for filtering</li>
</ul><h2>
<a name="constructor" class="anchor" href="#constructor"><span class="octicon octicon-link"></span></a>Constructor:</h2>

<div class="highlight highlight-js"><pre><span class="k">new</span> <span class="nx">QueryGenerator</span><span class="p">(</span><span class="nx">defaultLimit</span><span class="p">);</span>
</pre></div>

<p>For security reasons the construtor allows for providing a default limit value.
So if don't ever want to return more than x values, just put it in the constructor. If not, just leave it empty.</p>

<h2>
<a name="provides" class="anchor" href="#provides"><span class="octicon octicon-link"></span></a>provides:</h2>

<p>function generateQueryAddition(url)</p>

<ul>
<li>takes req.url object and generates a mysql addition query that can be added to a base query</li>
</ul><h2>
<a name="requrl-query-format" class="anchor" href="#requrl-query-format"><span class="octicon octicon-link"></span></a>req.url query format</h2>

<p>/someUrl?column.modifier=value</p>

<p>column: column to be filtered
modifier: type of filtering action
value: value to be filtered for</p>

<h3>
<a name="currently-supported-query-modifiers" class="anchor" href="#currently-supported-query-modifiers"><span class="octicon octicon-link"></span></a>currently supported query modifiers:</h3>

<p>modifier =&gt; mysql code =&gt; example</p>

<h3>
<a name="general" class="anchor" href="#general"><span class="octicon octicon-link"></span></a>general:</h3>

<ul>
<li>is =&gt; "=" =&gt; where column = value</li>
<li>isNot =&gt; "!=" =&gt; where column != value</li>
</ul><h3>
<a name="strings-only" class="anchor" href="#strings-only"><span class="octicon octicon-link"></span></a>strings only</h3>

<ul>
<li>contains =&gt; "like" =&gt; where column like '%value%'</li>
<li>containsNot =&gt; "not like" =&gt; where column not like '%value%'</li>
<li>startsWith =&gt; "like value%" =&gt; where columne like 'value%'</li>
<li>endsWith =&gt; "like %value" =&gt; where columne like '%value'</li>
</ul><h3>
<a name="numbers-only" class="anchor" href="#numbers-only"><span class="octicon octicon-link"></span></a>numbers only:</h3>

<ul>
<li>less =&gt; "&lt;" =&gt; where column &lt; value</li>
<li>lessOrEqual =&gt; "&lt;=" =&gt; where column &lt;= value</li>
<li>greater =&gt; "&gt;" =&gt; where column &gt; value</li>
<li>greaterOrEqual =&gt; "&gt;=" =&gt; where column &gt;= value</li>
</ul><p>illegal (those that are not supported) modifiers will be ignored</p>

<h3>
<a name="exception" class="anchor" href="#exception"><span class="octicon octicon-link"></span></a>exception</h3>

<p>?limit=value
limits the returned results to a certain number of entries and doesn't require any modifier</p>

<h2>
<a name="query-example" class="anchor" href="#query-example"><span class="octicon octicon-link"></span></a>query example:</h2>

<p>?name.rocks=7&amp;email.contains=<a href="https://github.com/gmail" class="user-mention">@gmail</a>&amp;id.greater=10&amp;id.lessOrEqual=100&amp;limit=8</p>

<p>would return
"where email like '%<a href="https://github.com/gmail" class="user-mention">@gmail</a>%' and id &gt; 10 and id &lt;= 100 limit 8;"</p>

<p>note: name.rocks is an illegal modifier and therefore ignored</p>

<h2>
<a name="usage-example" class="anchor" href="#usage-example"><span class="octicon octicon-link"></span></a>usage example:</h2>

<div class="highlight highlight-js"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/someUrl'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">QueryGenerator</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mysql-query-generator'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QueryGenerator</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">queryAddition</span> <span class="o">=</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">generateQueryAddition</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">completeQuery</span> <span class="o">=</span> <span class="s1">'select id, username, email from users '</span> <span class="o">+</span> <span class="nx">queryAddition</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// assuming a req.url querystring like so: ?username.is=john&amp;email.contains=john.doe&amp;id.greaterOrEqual=10&amp;limit=5</span>
<span class="c1">// the complete query would be</span>
<span class="kd">var</span> <span class="nx">completeQuery</span> <span class="o">=</span> <span class="s1">'select id, username, email from users where name = \'john\' and email like \'%john.doe%\'</span> <span class="nx">and</span> <span class="nx">id</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="nx">limit</span> <span class="mi">5</span><span class="p">;</span>
</pre></div>

<h2>
<a name="security-as-of-v030" class="anchor" href="#security-as-of-v030"><span class="octicon octicon-link"></span></a>Security as of v0.3.0</h2>

<h3>
<a name="injections" class="anchor" href="#injections"><span class="octicon octicon-link"></span></a>Injections</h3>

<p>To prevent sql injections certain characters and keywords are not allowed like:</p>

<ul>
<li>quotes</li>
<li>whitespaces</li>
</ul><h3>
<a name="limit-number-of-returned-entries" class="anchor" href="#limit-number-of-returned-entries"><span class="octicon octicon-link"></span></a>Limit number of returned entries</h3>

<p>You can provide a default limit in the constructor to make sure no more than that number of entries is returned.</p>

<h2>
<a name="npm" class="anchor" href="#npm"><span class="octicon octicon-link"></span></a>NPM</h2>

<p><a href="https://www.npmjs.org/package/mysql-query-generator">Check it out at NPM!</a>.
npm install mysql-query-generator</p>

<h3>
<a name="originally-intended-as-an-addition-to-query-sql" class="anchor" href="#originally-intended-as-an-addition-to-query-sql"><span class="octicon octicon-link"></span></a>Originally intended as an addition to <a href="https://www.npmjs.org/package/query-sql">query-sql</a>.</h3>

<p>Easily generate simple queries using query-sql. Then automatically parse url get string and add the result as where clause for more extensive filtering.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p><a href="http://cheeaun.mit-license.org/">MIT</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/TPei/nodejs-mysql-query-generator/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/TPei/nodejs-mysql-query-generator/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/TPei/nodejs-mysql-query-generator"></a> is maintained by <a href="https://github.com/TPei">TPei</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>